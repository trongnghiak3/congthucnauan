<!-- Ti√™u ƒë·ªÅ v√† n√∫t Th√™m C√¥ng Th·ª©c -->
<div class="flex justify-between items-center px-6 py-4 bg-gray-50 shadow-sm">
  <h1 class="text-2xl font-semibold text-[#D2691E] flex items-center">
    üçΩÔ∏è Danh S√°ch C√¥ng Th·ª©c
  </h1>
  <a
    href="#"
    onclick="loadPage('/admin/recipes/add', this)"
    class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition duration-300 ease-in-out shadow-md"
  >
    Th√™m C√¥ng Th·ª©c
  </a>
</div>

<!-- B·∫£ng danh s√°ch c√¥ng th·ª©c -->
<div class="overflow-x-auto px-6 py-4">
  <table class="min-w-full border bg-white shadow-md rounded-lg">
    <thead>
      <tr class="bg-yellow-500 text-white text-sm">
        <th class="p-2 border-r">ID</th>
        <th class="p-2 border-r">T√™n</th>
        <th class="p-2 border-r">M√¥ t·∫£</th>
        <th class="p-2 border-r">H∆∞·ªõng d·∫´n</th>
        <th class="p-2 border-r">Ng∆∞·ªùi t·∫°o</th>
        <th class="p-2 border-r">S·ªë ph·∫ßn</th>
        <th class="p-2 border-r">Th·ªùi gian</th>
        <th class="p-2 border-r">ƒê·ªô kh√≥</th>
        <th class="p-2 border-r">H√¨nh ·∫£nh</th>
        <th class="p-2 border-r">Video</th>
        <th class="p-2 border-r">Ng√†y t·∫°o</th>
        <th class="p-2 border-r">Tr·∫°ng th√°i</th>
        <th class="p-2">H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <% if (recipes && recipes.length > 0) { %>
        <% recipes.forEach((recipe, index) => { %>
          <tr class="text-sm text-gray-700 border-t hover:bg-gray-50">
            <td class="p-2 border-r"><%= index + 1 %></td>
            <td class="p-2 border-r font-medium"><%= recipe.ten_ct %></td>
            <td class="p-2 border-r line-clamp-2"><%= recipe.mo_ta %></td>
            <td class="p-2 border-r">
              <button onclick="toggleInstructions('<%= recipe.id_chinh %>')" class="text-blue-500 hover:text-blue-700">
                Xem <span id="toggle-icon-<%= recipe.id_chinh %>">‚ñº</span>
              </button>
              <div id="instructions-<%= recipe.id_chinh %>" class="hidden mt-1 text-sm bg-gray-100 p-2 rounded space-y-2">
                <% if (recipe.huong_dan) { 
                  const lines = recipe.huong_dan.trim().split(/\r?\n/).filter(line => line.trim() !== '');
                  for (let i = 0; i < lines.length; i += 2) {
                    const stepTitle = lines[i] || '';
                    const stepDesc = lines[i + 1] || '';
                %>
                  <div>
                    <span class="font-semibold"><%= stepTitle %></span><br/>
                    <span><%= stepDesc %></span>
                  </div>
                <% } 
                } else { %>
                  <div>Ch∆∞a c√≥ h∆∞·ªõng d·∫´n n·∫•u.</div>
                <% } %>
              </div>
            </td>
            <td class="p-2 border-r"><%= recipe.user === 'admin' ? 'Admin' : (recipe.user || 'Kh√¥ng r√µ') %></td>
            <td class="p-2 border-r"><%= recipe.so_phan_an %> ph·∫ßn</td>
            <td class="p-2 border-r"><%= recipe.thoi_gian_nau %> ph√∫t</td>
            <td class="p-2 border-r">
              <span class="inline-block px-2 py-1 rounded-full text-xs
                <%= recipe.do_kho === 'D·ªÖ' ? 'bg-green-100 text-green-700' :
                  recipe.do_kho === 'Trung b√¨nh' ? 'bg-yellow-100 text-yellow-700' :
                  'bg-red-100 text-red-700' %>">
                <%= recipe.do_kho %>
              </span>
            </td>
            <td class="p-2 border-r">
              <% if (recipe.hinh_anh) { %>
                <a href="<%= recipe.hinh_anh %>" target="_blank">
                  <img src="<%= recipe.hinh_anh %>" alt="·∫¢nh m√≥n ƒÉn" class="w-14 h-14 object-cover rounded shadow-md hover:scale-105 transition" />
                </a>
              <% } else { %>
                <span class="text-gray-500">Kh√¥ng c√≥</span>
              <% } %>
            </td>
            <td class="p-2 border-r">
              <% if (recipe.video_url) { %>
                <a href="<%= recipe.video_url %>" target="_blank" class="text-blue-500 hover:text-blue-700">Xem ‚ñ∂</a>
              <% } else { %>
                <span class="text-gray-500">Kh√¥ng c√≥</span>
              <% } %>
            </td>
            <td class="p-2 border-r">
              <%= new Date(recipe.ngay_tao).toLocaleDateString('vi-VN') %>
            </td>
            <td class="p-2 border-r">
              <span class="inline-block px-2 py-1 rounded-full text-xs
                <%= recipe.status === 'ƒê√£ duy·ªát' ? 'bg-green-100 text-green-700' :
                  recipe.status === 'ƒêang ch·ªù duy·ªát' ? 'bg-yellow-100 text-yellow-700' :
                  'bg-red-100 text-red-700' %>">
                <%= recipe.status %>
              </span>
            </td>
            <td class="p-2">
              <div class="flex space-x-2">
                <a href="#" onclick="event.preventDefault(); loadPage('/admin/recipes/edit/<%= recipe.id_chinh %>', this)" class="text-yellow-500 hover:text-yellow-600" title="Ch·ªânh s·ª≠a">‚úèÔ∏è</a>
                <% if (recipe.status === 'ƒêang ch·ªù duy·ªát') { %>
                  <button onclick="confirmApprove('<%= recipe.id_chinh %>')" class="text-green-500 hover:text-green-600" title="Duy·ªát">‚úÖ</button>
                <% } %>
                <button onclick="confirmDelete('<%= recipe.id_chinh %>')" class="text-red-500 hover:text-red-600" title="X√≥a">‚ùå</button>
              </div>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="13" class="p-3 text-center text-gray-500">Kh√¥ng c√≥ c√¥ng th·ª©c n√†o ƒë·ªÉ hi·ªÉn th·ªã.</td>
        </tr>
      <% } %>
    </tbody>
  </table>

  <% if (typeof totalPages !== 'undefined' && totalPages > 1) { %>
    <div class="mt-4 flex justify-center space-x-1">
      <% if (currentPage > 1) { %>
        <a href="#" 
           onclick="loadPage('/admin/recipes?page=<%= currentPage - 1 %>'); return false;"
           class="px-3 py-1 rounded border text-sm bg-white text-gray-700 hover:bg-gray-100">‚Äπ Tr∆∞·ªõc</a>
      <% } %>

      <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="#"
           onclick="loadPage('/admin/recipes?page=<%= i %>'); return false;"
           class="px-3 py-1 rounded border text-sm <%= i === currentPage ? 'bg-yellow-500 text-white' : 'bg-white text-gray-700 hover:bg-gray-100' %>">
          <%= i %>
        </a>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <a href="#"
           onclick="loadPage('/admin/recipes?page=<%= currentPage + 1 %>'); return false;"
           class="px-3 py-1 rounded border text-sm bg-white text-gray-700 hover:bg-gray-100">Sau ‚Ä∫</a>
      <% } %>
    </div>
  <% } %>
</div>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}
.rotate-180 {
  transform: rotate(180deg);
}
</style>